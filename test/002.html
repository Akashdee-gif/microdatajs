<!DOCTYPE html>
<html>
<head>
<title>element.properties</title>
<script src="../microdata.js"></script>
</head>
<body>
<p>FAIL (script didn't run)</p>
<div id="a" item>
  <div id="aa" itemprop="org.example.foo">foo</div>
  <div id="ab" itemprop="org.example.bar">
    bar
    <div id="aba" itemprop="org.example.foo">foo</div>
  </div>
</div>
<div id="b">
  <div id="ba" itemprop="org.example.foo">foo</div>
  <div id="bb" itemprop="org.example.bar">
    bar
    <div id="bba" itemprop="org.example.foo">foo</div>
  </div>
</div>
</body>
<script>
function listeq(list1, list2) {
  if (list1.length != list2.length)
    return false;
  for (var i = 0; i < list1.length; i++) {
    if (list1[i] != list2[i])
      return false;
  }
  return true;
}

function normalize(str) {
  return str.replace(/^\s+|\s+$/g, '').replace(/\s+/g, ' ');
}

var passed = true;
var props;
var namedProps;

props = document.getElementById('a').properties;
passed &= props.length == 3;
passed &= props[0] == document.getElementById('aa');
passed &= props[0] == props.item(0);
passed &= props[1] == document.getElementById('ab');
passed &= props[1] == props.item(1);
passed &= props[2] == document.getElementById('aba');
passed &= props[2] == props.item(2);
passed &= listeq(props.names, ['org.example.foo', 'org.example.bar']);
namedProps = props.namedItem('org.example.foo');
passed &= namedProps.length == 2;
passed &= namedProps.item(0) == document.getElementById('aa');
passed &= namedProps.item(1) == document.getElementById('aba');
passed &= listeq(namedProps.contents, ['foo', 'foo']);
namedProps = props.namedItem('org.example.bar');
passed &= namedProps.length == 1;
passed &= namedProps.item(0) == document.getElementById('ab');
passed &= listeq(map(namedProps.contents, normalize), ['bar foo']);

props = document.getElementById('b').properties;
passed &= props.length == 0;
passed &= listeq(props.names, []);
namedProps = props.namedItem('org.example.foo');
passed &= namedProps.length == 0;
passed &= listeq(namedProps.contents, []);
namedProps = props.namedItem('org.example.bar');
passed &= namedProps.length == 0;
passed &= listeq(namedProps.contents, []);

document.getElementsByTagName('p')[0].innerHTML = passed ? 'PASS' : 'FAIL';
</script>
</html>
